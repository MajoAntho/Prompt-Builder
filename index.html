<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/design-system.css">
    <title>Prompt Builder Pro 2.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body data-theme="dark">
    <header class="header">
        <div class="header-content">
            <div class="header-left"></div>
            <h1 class="logo">
                <span class="logo-icon">‚ú®</span>
                Prompt Builder Pro 2.0
            </h1>
            <div class="header-controls">
                <button class="btn btn-secondary" id="historyBtn">
                    <span>üìö</span> Historique
                </button>
                <button class="btn btn-secondary" id="importBtn">
                    <span>üì•</span> Importer
                </button>
                <button class="theme-toggle" id="themeToggleBtn" aria-label="Changer le th√®me">
                    <div class="theme-toggle-circle"></div>
                </button>
                <div class="save-indicator" id="saveIndicator" style="display: none; align-items: center; gap: 0.4rem; margin-left: 1.2rem;">
                    <span class="save-icon" style="font-size: 1.15rem;">üíæ</span>
                    <span class="save-text">Sauvegard√©</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="card editor-section">
            <div class="card-header">
                <h2 class="card-title">
                    <div class="card-icon">üìù</div>
                    Cr√©ateur de Prompt
                    <span class="badge">v2.0</span>
                </h2>
            </div>

            <div class="form-fields-container" id="formFieldsContainer" role="list">
                <div class="form-group" draggable="true" data-field="role" tabindex="0" aria-grabbed="false" role="listitem">
                    <div class="drag-handle" role="button" aria-label="D√©placer le champ R√¥le" tabindex="0">‚ãÆ‚ãÆ</div>
                    <label for="role">
                        R√¥le
                        <span class="tooltip">
                            <span class="tooltip-trigger">‚ìò</span>
                            <span class="tooltip-content">D√©finissez le r√¥le ou l'expertise de l'IA</span>
                        </span>
                    </label>
                    <input type="text" id="role" placeholder="Ex: Tu es un expert en marketing digital..." />
                </div>

                <div class="form-group" draggable="true" data-field="context" tabindex="0" aria-grabbed="false" role="listitem">
                    <div class="drag-handle" role="button" aria-label="D√©placer le champ Contexte" tabindex="0">‚ãÆ‚ãÆ</div>
                    <label for="context">
                        Contexte
                        <span class="tooltip">
                            <span class="tooltip-trigger">‚ìò</span>
                            <span class="tooltip-content">Fournissez le contexte n√©cessaire</span>
                        </span>
                    </label>
                    <textarea id="context" placeholder="Ex: Dans le cadre d'une campagne de lancement..."></textarea>
                </div>

                <div class="form-group" draggable="true" data-field="task" tabindex="0" aria-grabbed="false" role="listitem">
                    <div class="drag-handle" role="button" aria-label="D√©placer le champ T√¢che" tabindex="0">‚ãÆ‚ãÆ</div>
                    <label for="task">
                        T√¢che
                        <span class="tooltip">
                            <span class="tooltip-trigger">‚ìò</span>
                            <span class="tooltip-content">D√©crivez la t√¢che √† accomplir</span>
                        </span>
                    </label>
                    <textarea id="task" placeholder="Ex: Ta mission est de cr√©er une strat√©gie..."></textarea>
                </div>

                <div class="form-group" draggable="true" data-field="instructions" tabindex="0" aria-grabbed="false" role="listitem">
                    <div class="drag-handle" role="button" aria-label="D√©placer le champ Instructions" tabindex="0">‚ãÆ‚ãÆ</div>
                    <label for="instructions">
                        Instructions
                        <span class="tooltip">
                            <span class="tooltip-trigger">‚ìò</span>
                            <span class="tooltip-content">Listez les directives sp√©cifiques</span>
                        </span>
                    </label>
                    <textarea id="instructions" placeholder="Ex: - Utilise un ton professionnel&#10;- Structure en sections&#10;- Inclus des exemples"></textarea>
                </div>

                <div class="form-group" draggable="true" data-field="output" tabindex="0" aria-grabbed="false" role="listitem">
                    <div class="drag-handle" role="button" aria-label="D√©placer le champ Format de sortie" tabindex="0">‚ãÆ‚ãÆ</div>
                    <label for="output">
                        Format de sortie
                        <span class="tooltip">
                            <span class="tooltip-trigger">‚ìò</span>
                            <span class="tooltip-content">Pr√©cisez le format souhait√©</span>
                        </span>
                    </label>
                    <input type="text" id="output" placeholder="Ex: Rapport structur√© avec tableaux" />
                </div>

                <div class="form-group" draggable="true" data-field="variables" tabindex="0" aria-grabbed="false" role="listitem">
                    <div class="drag-handle" role="button" aria-label="D√©placer le champ Variables" tabindex="0">‚ãÆ‚ãÆ</div>
                    <label>
                        Variables personnalis√©es
                        <span class="tooltip">
                            <span class="tooltip-trigger">‚ìò</span>
                            <span class="tooltip-content">Ajoutez des variables dynamiques</span>
                        </span>
                    </label>
                    <div class="variables-container" id="variablesContainer">
                        <div class="variable-item">
                            <input type="text" placeholder="Nom de la variable" class="var-name" aria-label="Nom de la variable" />
                            <input type="text" placeholder="Valeur" class="var-value" aria-label="Valeur de la variable" />
                            <button class="btn btn-danger var-remove" tabindex="0" aria-label="Supprimer la variable" role="button">‚úï</button>
                            <button class="btn btn-secondary var-up" tabindex="0" aria-label="Monter la variable" role="button">‚ñ≤</button>
                            <button class="btn btn-secondary var-down" tabindex="0" aria-label="Descendre la variable" role="button">‚ñº</button>
                        </div>
                    </div>
                    <button class="btn btn-secondary" id="addVariableBtn" tabindex="0" aria-label="Ajouter une variable">
                        <span>‚ûï</span> Ajouter une variable
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="template">Templates pr√©d√©finis</label>
                <div class="template-dropdown">
                    <button class="template-button" id="templateDropdownBtn" tabindex="0" aria-haspopup="listbox" aria-expanded="false" aria-label="Ouvrir la liste des templates">
                        <span id="selectedTemplate">-- Choisir un template --</span>
                        <span>‚ñº</span>
                    </button>
                    <div class="template-dropdown-menu" id="templateDropdownMenu" role="listbox" aria-label="Templates pr√©d√©finis" aria-hidden="true">
                        <!-- Les templates seront g√©n√©r√©s dynamiquement -->
                    </div>
                </div>
            </div>
        </div>

        <div class="card preview-section">
            <div class="card-header">
                <h2 class="card-title">
                    <div class="card-icon">üëÅÔ∏è</div>
                    Aper√ßu du Prompt
                    <span class="loader" id="previewLoader" style="display: none;"></span>
                </h2>
            </div>

            <div class="format-tabs" role="tablist">
                <button class="tab active" id="formatTextBtn" role="tab" aria-selected="true" tabindex="0">Texte</button>
                <button class="tab" id="formatMarkdownBtn" role="tab" aria-selected="false" tabindex="0">Markdown</button>
                <button class="tab" id="formatJsonBtn" role="tab" aria-selected="false" tabindex="0">JSON</button>
                <button class="tab" id="formatXmlBtn" role="tab" aria-selected="false" tabindex="0">XML</button>
            </div>

            <div class="preview-content" id="previewContent" tabindex="0" aria-label="Aper√ßu du prompt">
                <div class="preview-placeholder">
                    <div class="preview-placeholder-icon">üìù</div>
                    <div>Commencez √† remplir le formulaire pour voir l'aper√ßu...</div>
                </div>
            </div>

            <div class="actions">
                <button class="btn" id="copyBtn" aria-label="Copier le contenu de l'aper√ßu">
                    <span>üìã</span> Copier
                </button>
                <button class="btn btn-secondary" id="downloadBtn">
                    <span>üíæ</span> T√©l√©charger
                </button>
                <button class="btn btn-secondary" id="shareBtn">
                    <span>üîó</span> Partager
                </button>
                <button class="btn btn-secondary" id="undoBtn" title="Annuler (Ctrl+Z)" aria-label="Annuler la derni√®re modification">
                    <span>‚éå</span> Annuler
                </button>
                <button class="btn btn-secondary" id="redoBtn" title="Restaurer (Ctrl+Y)" aria-label="Restaurer la modification annul√©e">
                    <span>‚Ü∫</span> Restaurer
                </button>
                <button class="btn btn-secondary" id="clearBtn">
                    <span>üóëÔ∏è</span> R√©initialiser
                </button>
            </div>
        </div>
    </div>

    <!-- Panel d'historique -->
    <div class="history-panel" id="historyPanel">
        <div class="card-header">
            <h3 class="card-title">
                <div class="card-icon">üìö</div>
                Historique
            </h3>
        </div>
        <div id="historyList">
            <!-- L'historique sera g√©n√©r√© dynamiquement -->
        </div>
    </div>

    <!-- Modal d'import -->
    <div class="modal" id="importModal" role="dialog" aria-modal="true" aria-labelledby="importModalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="importModalTitle">üì• Importer un prompt</h3>
                <button class="modal-close" id="importModalCloseBtn">‚úï</button>
            </div>
            <div class="form-group">
                <label>Format d√©tect√© : <span id="detectedFormat" style="color: var(--accent);">-</span></label>
                <textarea id="importTextarea" rows="12" placeholder="Collez votre prompt ici (JSON, XML, Markdown ou Texte)..."></textarea>
            </div>
            <div style="display: flex; gap: 0.75rem; justify-content: flex-end; margin-top: 1.5rem;">
                <button class="btn btn-secondary" id="importModalCancelBtn">Annuler</button>
                <button class="btn" id="importModalImportBtn">
                    <span>üì•</span> Importer
                </button>
            </div>
        </div>
    </div>

    <!-- Container pour les toasts -->
    <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>

    <script type="module" src="scripts/app.js"></script>
</body>
</html>